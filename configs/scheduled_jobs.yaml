jobs:
  # Periodic job to fetch indices information
  - name: fetch_indices
    type: preDefined
    internalJobName: runCatIndices
    enabled: true
    schedule:
      interval: 3m
      initialWait: 1m
    parameters:
      excludeClusters: []
      excludeIndices: []  # Optional: List of regex patterns to exclude indices
      includeOnlyIndices: []  # Optional: List of regex patterns - only matching indices stored (overrides excludeIndices)
      triggerJobs: ["analyze_rates"]  # Optional: Jobs to trigger after this job completes

  # Dependent job to analyze indexing rates (also triggered by fetch_indices)
  - name: analyze_rates
    type: preDefined
    internalJobName: analyseIngest
    enabled: true
    dependsOn: ["fetch_indices"]  # Can still use dependsOn for clarity
    parameters:
      excludeClusters: []
      triggerJobs: []  # Optional: Jobs to trigger after analysis completes

 

  # Thread pool write queue monitoring job
  - name: get_host_threadpool_metrics
    type: preDefined
    internalJobName: getThreadPoolWriteQueue
    enabled: true  # Disabled by default - requires monitoring cluster setup
    schedule:
      interval: 10m
      initialWait: 3m
    parameters:
      excludeClusters: []
      triggerJobs: ["check_writeThreadQueues"]  # Trigger write pressure check after collecting metrics
      spanInterval: "30s"
      timeSpan: "10m"
      parallelRoutines: 5
      insecureTLS: false
      APIKEY: ""  # Set your monitoring cluster API key here
      APIEndPoints:
        - "https://monitoring-es:9200/.monitoring-es-*/_search"
      # Optional: Custom query template (uses default if not specified)
      # query: |
      #   {
      #     "aggs": { ... }
      #   }
      # Optional: Custom JSON paths (uses defaults if not specified)
      # resultsJsonPaths:
      #   hostName: "aggregations.hostname.buckets.key"
      #   metrics: "aggregations.hostname.buckets.date_bucket.buckets.2.top_metrics.metrics.node_stats.thread_pool.write.queue"
      #   metricTimestamp: "aggregations.hostname.buckets.date_bucket.buckets.key"

  # Write pressure detection job
  - name: check_writeThreadQueues
    type: preDefined
    internalJobName: checkForWritePressure
    enabled: true
    dependsOn: ["get_host_threadpool_metrics"]  # Runs after thread pool metrics are collected
    parameters:
      excludeClusters: []  # Optional: List of cluster names to exclude from write pressure checks
      thresholdValue: 700  # Default threshold for thread pool write queue (default: 700)
      noOfConsecutiveIntervals: 3  # Number of consecutive intervals above threshold to trigger alert (default: 3)
      considerMissingDataPoint: "missing"  # Options: "missing" (filter out), "nonOffending" (treat as below threshold), "offending" (treat as above threshold)
