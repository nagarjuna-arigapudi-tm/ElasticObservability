jobs:
  # Initialization job to load cluster data from CSV
  - name: load_clusters
    type: preDefined
    internalJobName: loadFromMasterCSV
    enabled: true
    initJob: true
    parameters:
      csv_fileName: ./data/clusters.csv
      inputMapping:
        constant:
          insecureTLS: true
          port: "9200"
        straight:
          clusterName: "Cluster Name"
          clusterSAN: "API Endpoint"
          kibanaSAN: "Kibana Endpoint"
          owner: "Owner"
          hostName: "Node Name"
          ipAddress: "IP Address"
          zone: "Zone"
          dataCenter: "Data Center"
        derived:
          - field: active
            column: "Status"
            function: boolStringCompare
            arg: ["active", "managed", "production"]
          - field: env
            column: "Environment"
            function: strStringCompare
            arg: [["dev","development"], ["qa","testing","uat","qat"], ["prd","production","prod"]]
            retVal: ["dev", "uat", "prd"]
          - field: type
            column: "Node Type"
            function: splitString

  # Update active endpoints after loading clusters
  - name: update_endpoints
    type: preDefined
    internalJobName: updateActiveEndpoint
    enabled: true
    initJob: true
    dependsOn: ["load_clusters"]
    parameters:
      excludeClusters: []

  # Periodic job to fetch indices information
  - name: fetch_indices
    type: preDefined
    internalJobName: runCatIndices
    enabled: true
    schedule:
      interval: 3m
      initialWait: 1m
    parameters:
      excludeClusters: []

  # Dependent job to analyze indexing rates
  - name: analyze_rates
    type: preDefined
    internalJobName: analyseIngest
    enabled: true
    dependsOn: ["fetch_indices"]
    parameters:
      excludeClusters: []

  # Periodic endpoint health check
  - name: periodic_endpoint_check
    type: preDefined
    internalJobName: updateActiveEndpoint
    enabled: true
    schedule:
      interval: 15m
      initialWait: 5m
    parameters:
      excludeClusters: []
